# [Project Name] — Agent Contract (Codex)

Эти инструкции — контракт работы coding‑агента в этом репозитории.
Цель: максимальная автономность при сохранении безопасности и проверяемости.

---

## ExecPlans

При написании сложных функций или значительных рефакторингов агент **обязан**
использовать ExecPlan (как описано в `.agent/PLANS.md`) от проектирования до реализации.

Первый план по умолчанию: `docs/execplans/pilot_execplan.md`.

---

## Commands (source of truth)

Заполни реальные команды проекта. Агент должен использовать их как “судью”.

| Command | Purpose |
|--------|---------|
| `<format>` | Format |
| `<lint>` | Lint |
| `<typecheck>` | Typecheck (optional) |
| `<test>` | Tests |
| `<dev>` | Run dev server (optional) |

---

## Git workflow (autocommits)

Цель: частые безопасные чекпойнты без “шума”.

- Коммить **после** того как:
  1) шаг по ExecPlan завершён,
  2) проверки из `docs/constitution/QUALITY_GATES.md` прошли,
  3) ExecPlan обновлён (Progress + evidence).
- Коммиты — **локальные**. Не использовать remote (`git push`, PR) без Ask‑first.
- Не переписывать историю без Ask‑first (`rebase`, `commit --amend`, `reset --hard`, `push --force`).

Рекомендуемый формат сообщения:

```text
docs: bootstrap SDAD doc pack
feat(<scope>): <summary>
fix(<scope>): <summary>
refactor(<scope>): <summary>
test(<scope>): <summary>
```

---

## Always do

- Следовать текущему ExecPlan и обновлять секции: `Progress`, `Surprises & Discoveries`, `Decision Log`, `Outcomes & Retrospective`.
- Держать изменения маленькими и проверяемыми (thin slices).
- Перед завершением шага запускать релевантные проверки (минимум: тесты на изменённый модуль/пакет).
- Фиксировать evidence в ExecPlan: команда + короткий ожидаемый вывод.
- Указывать точные пути файлов и имена функций (никаких “в файле с контроллером”).
- После успешной валидации шага — сделать локальный commit (если репозиторий использует git).

---

## Ask first (остановиться и спросить)

Ограничь вопросы: **максимум 1–3**, с 2–4 взаимоисключающими вариантами и рекомендацией.

- Добавление/обновление production‑зависимостей.
- Миграции БД, breaking changes API, изменения контрактов данных.
- Изменение CI/CD, деплоя, секретов, прав доступа.
- Любые изменения в `docs/constitution/*` (immutable) — только через явное решение человека‑арбитра.
- Любые операции с remote (push/PR) и переписывание истории git (rebase/amend/reset/force).

---

## Never do

- Не отключать тесты/линт ради “зелёного”.
- Не коммитить секреты/ключи.
- Не делать “магические” изменения без проверок и evidence.
- Не пушить изменения во внешние репозитории без явного запроса.

---

## Output & progress hygiene

- Не спрашивать “что дальше?” после того как план понятен — переходить к следующему шагу.
- Если заблокирован: добавить запись в ExecPlan (“Blocker”) с evidence и вариантами решения.
- Считать, что агент может быть перезапущен: всё важное должно жить в документах, а не в чате.
